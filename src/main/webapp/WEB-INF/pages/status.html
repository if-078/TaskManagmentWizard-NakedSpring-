<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Example page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>
        .status {
            background-color: #666;
            border: 3px solid black;
            width: 300px;
            height: 300px;
        }

        #statuses div {
            display: inline-block;
        }

        button {
            display: inline-block;
        }



    </style>

</head>
<body>

<div id="container">
    <button id="showStatuses">Show Statuses</button>
    <button id="addStatus">Add status</button>
    <div id="statuses"></div>

    <form id="addStatusForm" style="display:none">
        <p>Insert Status Name:</p>
        <input id="statusName" type="text"></br>
        <input type="submit" value="Create">
    </form>

</div>
<script>
    $(document).ready(function () {
        $("#showStatuses").click(function () {
        clearStatuses();
        getStatus();
        });
        $("#addStatus").click(function () {
            showForm();
        });
        $("#addStatusForm").submit(function (event) {
        addStatus();
        event.preventDefault();
            });

        $("#statuses").on("click", ".delete" ,function () {
        deleteStatus($(this).attr("id"));

        });
        $("#statuses").on("click", ".update" ,function (event) {
        var target=$(event.target);
        addUpdateInput(target);
        $(".status").on("submit","#updateStatusForm",function (event) {
        var target=$(event.target);
        var id=$(target).parent(".name").prev(".id").html();
        var name=$("#statusName").val();
        var json = {"id":id,"name": name};
        console.log(target);
        updateStatus(json);  
        event.preventDefault();
        });
        });
        
    });

    function addStatus() {
        var name = $("#statusName").val();
        var json = {"name": name};
        $.ajax({
            url: 'status/',
            type: "POST",
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(json),
            success:function(){
            clearStatuses();
            getStatus();
            hideForm();
            }
        });

    }

    function deleteStatus(id) {
        json = {"id": id};
        $.ajax({
            url: 'status/del',
            type: "DELETE",
            data: JSON.stringify(json),
            success: function (data) {
                if (data == true) {
                clearStatuses();
            getStatus();
                    alert("Deleting success")
                }
            }
        });
    }

    function updateStatus(json) {
        $.ajax({
            url: "status/update",
            type: "PUT",
            data:JSON.stringify(json),
            success: function (data) {
               if (data == true) {
                clearStatuses();
                getStatus();
                alert("Updating success")
                }
            }});
    }

    function getStatus() {
        $.ajax({
            url: "status/",
            type: "GET",
            success: function (data) {
                var list = JSON.parse(data);
                renderStatuses(list);
            }
        });
    }


    function renderStatuses(list) {
        for (var status = 0; status < list.length; status++) {
            $("#statuses").append("<div class='status' id='" + list[status].id + "'><p class='id'>" + list[status].id + "</p><p class='name'> " + list[status].name + "</p><button class='delete' id='"+ list[status].id +"' >Delete</button> <button class='update'>Update</button></div>");
        }
    }


    function showForm() {
        $("#addStatusForm").show(1000, function () {
            $("#addStatus").hide();
        });
    }

    function hideForm() {
        $("#addStatus").show(1000, function () {
            $("#addStatusForm").fadeOut();
        });

    }

    function clearStatuses() {
        $("#statuses .status").remove();
    }
    function addUpdateInput(target){
    target.siblings(".name").html("<form id='updateStatusForm' ><input id='statusName' type='text'></br><input type='submit' value='Update'></form>");

    }


</script>
</body>
</html>